#PriceLevel
#Price level based on trailing price average (3 days for hourly values and 30 days for daily values)
# NORMAL: The price is greater than 90 % and smaller than 115 % compared to average price.
# CHEAP: The price is greater than 60 % and smaller or equal to 90 % compared to average price.
# VERY_CHEAP: The price is smaller or equal to 60 % compared to average price.
# EXPENSIVE: The price is greater or equal to 115 % and smaller than 140 % compared to average price.
# VERY_EXPENSIVE: The price is greater or equal to 140 % compared to average price.

# 2025-0-28 - I've removed the Tibber API request.
#             I will start using the official Tibber integration with `tibber.get_prices` service.

template:
  - sensor:
      - name: Total electricity price
        unique_id: 84932203-6512-4e6c-9002-bf51b63d7a52
        unit_of_measurement: "SEK/kWh"
        availability: "{{ is_number(states('sensor.borasvagen_electricity_price')) }}"
        state: >
          {% set electricity_price = 0.3125 + states('sensor.borasvagen_electricity_price') | float(0) %}
          {{ (electricity_price) | round(4, default=0) }}

      - name: CO2 cost rate
        unique_id: df385245-cd24-4b58-8535-b683ab0b3f88
        unit_of_measurement: "gCO2eq/h"
        device_class: monetary
        availability: "{{ is_number(states('sensor.co2_intensity')) and is_number(states('sensor.total_power')) }}"
        state: >- # sensor.co2_intensity
          {{
            (
              states('sensor.co2_intensity') | float(0)
              * states('sensor.total_power') | float(0)
              / 1000
            ) | round(1)
          }}

      - name: Energy cost rate
        unique_id: a6e64783-7974-4a7c-a724-cda241643a10
        unit_of_measurement: "SEK/h"
        device_class: monetary
        availability: "{{ is_number(states('sensor.total_electricity_price')) and is_number(states('sensor.total_power')) }}"
        state: >-
          {{
            (
              states('sensor.total_electricity_price') | float(0)
              * states('sensor.total_power') | float(0)
              / 1000
            ) | round(2)
          }}

#tibber_data: # https://github.com/Danielhiversen/home_assistant_tibber_data
  #email: !secret tibber_email
  #password: !secret tibber_pass
